{% load hq_shared_tags %}
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>CommCareHQ Test</title>
    <script src="{% static 'jquery/dist/jquery.min.js' %}"></script>
    <script src="{% static 'underscore/underscore.js' %}"></script>
    <!-- Mocha and test-only dependencies -->
    <link href="{% static 'mocha/mocha.css' %}" type="text/css" rel="stylesheet"></link>
    <script src="{% static 'mocha/mocha.js' %}"></script>
    <script src="{% static 'chai/chai.js' %}"></script>
    <script src="{% static 'sinon/index.js' %}"></script>
    <script src="{% static 'hqwebapp/js/hqModules.js' %}"></script>
    <script src="{% static 'hqwebapp/js/initial_page_data.js' %}"></script>
    <script>
        mocha.setup('bdd')
        window.assert = chai.assert

        function gettext(str) {
            return str;
        }
    </script>

    <!-- Core Libraries -->
    {% block core_libraries %}
    {% include "hqwebapp/includes/jquery.html" %}
    {% include "hqwebapp/includes/core_libraries.html" %}
    {% include "hqwebapp/includes/ko.html" %}
    <script src="{% static 'bootstrap/dist/js/bootstrap.min.js' %}"></script>
    <script src="{% static 'hqwebapp/js/hq.helpers.js' %}"></script>
    {% endblock %}

    <!-- App specific dependencies -->
    {% block dependencies %}{% endblock %}

    {% include 'analytics/analytics_js.html' %}
    <script>
        hqImport('analytix/js/google').track.event = sinon.spy();
        hqImport('analytix/js/google').track.click = sinon.spy();
        hqImport('analytix/js/kissmetrix').track.event = sinon.spy();
    </script>
  </head>
  <body>
      <div class="initial-analytics-data hide"></div>
      <div class="analytics-ab-tests hide"></div>
      <!-- HTML Fixtures -->
      <div id="mocha"></div>
      <div id="mocha-fixtures" style="display:none">
      {% block fixtures %}{% endblock %}
      </div>
      {% block mocha_tests %}{% endblock %}
      <script charset="utf-8">
	// Only tests run in real browser, injected script run if options.run == true
	if (navigator.userAgent.indexOf('PhantomJS') < 0) {
	  mocha.run();
	}
      </script>
  </body>
</html>
